---
title: "DSA 5013-001 Homework 8"
author: "Group 19: Zachary White, Azadeh Gilanpour, Precious Jatau"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: word_document
geometry: margin = 0.8in
documentclass: article
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

These are the libraries used:

```{r, results='hide'}
library(cluster)
library(rgl)
library(useful) 
library(dplyr)
library(dbscan)
library(factoextra)
```

#Problem 1. Cluster Analysis

##Problem 1a

*Identify a data set for cluster analysis. The data set must have a minimum of 8 numeric variables and 500 observations.*

We are using a red wine classification set from kaggle. (https://www.kaggle.com/piyushgoyal443/red-wine-dataset/)
It contains 1599 observations and 11 numeric variables.

```{r}
wine=  read.csv("C:\\Users\\zackw\\Documents\\Classes\\Intelligent Data Analytics\\HW\\HW8\\wineQualityReds.csv")

#finding missigness
propMissing = function (x) mean(is.na(x))
missing = apply(wine,2, propMissing)
missing
```

```{r}
str(wine)
# delete varible x "it is row number"
wine$X = NULL
z= wine[,-c(12,12)]

#Sclae the data
wineScaled = data.frame(scale(z))
```

##Problem 1b

*Briefly describe the data set.*

The data contains information red wine and it leading to the quality (from 0 - 10). It contains 1599 observations and 11 numeric variables. There is a 12 variable in the dataset (quality) that is the output that ranges from 0-10 so there will be at most  unique 11 clusters. The information about the 11 variables is given from the kaggle website. 

    1 - fixed acidity: most acids involved with wine or fixed or nonvolatile (do not evaporate readily)
    2 - volatile acidity: the amount of acetic acid in wine, which at too high of levels can lead to an unpleasant, vinegar taste
    3 - citric acid: found in small quantities, citric acid can add 'freshness' and flavor to wines
    4 - residual sugar: the amount of sugar remaining after fermentation stops, it's rare to find wines with less than 1 gram/liter and wines with greater than 45 grams/liter are considered sweet
    5 - chlorides: the amount of salt in the wine
    6 - free sulfur dioxide: the free form of SO2 exists in equilibrium between molecular SO2 (as a dissolved gas) and bisulfite ion; it prevents microbial growth and the oxidation of wine
    7 - total sulfur dioxide: amount of free and bound forms of S02; in low concentrations, SO2 is mostly undetectable in wine, but at free SO2 concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine
    8 - density: the density of water is close to that of water depending on the percent alcohol and sugar content
    9 - pH: describes how acidic or basic a wine is on a scale from 0 (very acidic) to 14 (very basic); most wines are between 3-4 on the pH scale
    10 - sulphates: a wine additive which can contribute to sulfur dioxide gas (S02) levels, wich acts as an antimicrobial and antioxidant
    11 - alcohol: the percent alcohol content of the wine

##Problem 1c

*Perform a clustering analysis of this data set using:*

* *Partitional Clustering (use statistical and/or rational reasoning to determine k)*

```{r}
#kmeans
winekm = kmeans(wineScaled,3,nstart = 20)
winekm$cluster
winekm$centers
winekm$size
winekm
```

```{r}
# elbow method
set.seed(7)
k.max = 15
data = wineScaled
wass = sapply (1:k.max,function(k){kmeans(data,k,nstart=50,iter.max=15)$tot.withinss})
wass
plot(1:k.max,wass,
     type= "b",pch =19,frame= F,
     xlab= "Number of cluster",
     ylab= "Total within- cluster sum of squares")
abline(v=6)
```

```{r}
# chossing k=6 as clustring
winekm1= kmeans(wineScaled,6,nstart = 20)
winekm1$cluster
winekm1$centers
winekm1$size
winekm1
```

```{r}
# silhouette model
library(cluster)
library(rgl)
wineSample <- wineScaled[sample(1:nrow(wineScaled),100),]
winePAMs <- pam(wineSample, 6)
str(si <- silhouette(winePAMs))
(ssi <- summary(si))
plot(si) # silhouette plot
```

```{r}
winePAMs$medoids  #look at medoids of PAM

pc <- princomp(wineScaled, cor=TRUE, scores=TRUE)
summary(pc)

plot3d(pc$scores, size=6, col=winekm1$cluster, main="k-means clusters")
```

```{r}
#plot(wineScaled[c(1,4)],col= winekm1$cluster)
#plot(wineScaled[c(1,4)],col= winekm1$size)

#evaluates k using the "Hartigan" rule
library(useful) 
library(dplyr)
clusFit<-FitKMeans(wineScaled,max.clusters=30,nstart=20)   
clusFit
PlotHartigan(clusFit)
```

```{r}
#some kind of visulization of k-,means clustring
library(factoextra)
fviz_cluster(winekm1, data = wineScaled, geom = "point",
             stand = FALSE, frame.type = "norm")
```

* *Hierarchical Clustering (use statistical and/or rational reasoning to determine cut height)*

```{r}
# with hiearchical clustering
di <- dist(wineScaled, method="euclidean")   

hc <- hclust(di, method="ward.D")
plot(hc, labels=FALSE)

rect.hclust(hc, k=6, border="red")    
wineScaled$hcluster <- as.factor(cutree(hc, k=6))   

head(wineScaled)

#with dasiy Function
d<-daisy(wineScaled,metric="gower",stand=T)

hclus<-hclust(d,method="single")   
plot(hclus)

hclus<-hclust(d,method="average")
plot(hclus)

hclus<-hclust(d,method="ward.D")  
plot(hclus)
```

* *Density-Based Clustering (use statistical and/or rational reasoning to determine \(\epsilon\) and min points)*

```{r}
#3-dencity based clustring
library(dbscan)
winewmatrix= data.matrix(wineScaled)
head(kNNdist(winewmatrix, k=6)) 

kNNdistplot(winewmatrix, k=6)
abline(h=2, col="red") 
# i am not sure about the amont of h is true or not ?????

## the knee is around a distance of .3

res <- dbscan(winewmatrix, eps=2, minPts = 5)
res

## plot clusters and add noise (cluster 0) as crosses.
plot(winewmatrix, col=res$cluster)
points(winewmatrix[res$cluster==0,], pch = 3, col = "grey")

hullplot(winewmatrix, res)

library("fpc")
# Compute DBSCAN using fpc package
set.seed(123)
db <- fpc::dbscan(winewmatrix, eps = 2, MinPts = 5)
# Plot DBSCAN results
plot(db, winewmatrix, main = "DBSCAN", frame = FALSE)

##library("factoextra")
fviz_cluster(db, winewmatrix, stand = FALSE, frame = FALSE, geom = "point")
```

##Problem 1d

*Provide a concise, statistical description of the final cluster results for each method.*

##Problem 1e

*Identify the cluster solution you think is best and provide a rationale for your choice.*

##Problem 1f

*Provide an interpretation of the clusters belonging to your preferred solution. This interpretation will require a subjective analysis of the clusters.*
```{r}
pcWine = prcomp(wine, scale. = T)
biplot(pcWine)
windows()
biplot(pcWine)
newData = pcWine$x
newData = newData[,1:2] 
newData = as.data.frame(newData) 
ggplot(data = newData, aes(x = PC1, y = PC2)) + geom_point(col = wineScaled$hcluster)

```

